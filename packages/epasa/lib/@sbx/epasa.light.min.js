!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("@sbx/common")):"function"==typeof define&&define.amd?define("@sbx/epasa",["@sbx/common"],e):"object"==typeof exports?exports["@sbx/epasa"]=e(require("@sbx/common")):t["@sbx/epasa"]=e(t["@sbx/common"])}("undefined"!=typeof self?self:this,function(t){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=4)}([function(e,r){e.exports=t},function(t,e,r){const n=r(0).Util,a=Symbol("value"),o='"():<>[\\]{}'.split(""),c=`(${o.map(t=>n.escapeRegex(t)).join("|")})`;class s{constructor(t){this[a]=t instanceof s?t.toString():s.validate(t)}static validate(t){if(0===t.length)return t;for(let e=0;e<t.length;e++)if(t.charCodeAt(e)<32||t.charCodeAt(e)>126)throw new Error(`Invalid ascii - character ${t[e]} not allowed at position ${e}`);return t}toString(){return this[a]}toStringEscaped(){return this[a].replace(new RegExp(c,"gm"),"\\$1")}static isEscape(t,e){return"\\"===t&&o.indexOf(e)>-1}}t.exports=s},function(t,e,r){const n=r(0).Types.AccountNumber,a=r(0).Types.AccountName,o=r(7).v3,c=r(1),s=r(3),i=r(0).BC,h=Symbol("account_number"),d=Symbol("account_name"),u=Symbol("payload"),l=Symbol("payload_type"),A=Symbol("password");class E{static get NON_DETERMISTIC(){return 0}static get ENC_PUBLIC(){return 1}static get ENC_RECEIVER(){return 2}static get ENC_SENDER(){return 4}static get ENC_PASSWORD(){return 8}static get FORMAT_ASCII(){return 16}static get FORMAT_HEX(){return 32}static get FORMAT_BASE58(){return 64}static get ADDRESSED_BY_NAME(){return 128}static get MAX_PUBLIC_ASCII(){return 255}static get MAX_ECIES_ASCII(){return 144}static get MAX_AES_ASCII(){return 223}static get MAX_PUBLIC_HEX(){return 510}static get MAX_ECIES_HEX(){return 288}static get MAX_AES_HEX(){return 446}static get MAX_PUBLIC_BASE58(){return 348}static get MAX_ECIES_BASE58(){return 196}static get MAX_AES_BASE58(){return 304}constructor(){this[l]=E.NON_DETERMISTIC}set accountNumber(t){if(void 0!==this[d])throw new Error("Either set the account name or the account number. Both is not possible.");this[h]=new n(t)}get accountNumber(){return this[h]}get accountName(){return this[d]}hasFormat(){return this.isFormatBase58()||this.isFormatAscii()||this.isFormatHex()}hasEncryption(){return this.isEncryptionPublic()||this.isEncryptionPassword()||this.isEncryptionSender()||this.isEncryptionReceiver()}isFormatBase58(){return(this[l]&E.FORMAT_BASE58)===E.FORMAT_BASE58}isFormatAscii(){return(this[l]&E.FORMAT_ASCII)===E.FORMAT_ASCII}isFormatHex(){return(this[l]&E.FORMAT_HEX)===E.FORMAT_HEX}isEncryptionReceiver(){return(this[l]&E.ENC_RECEIVER)===E.ENC_RECEIVER}isEncryptionSender(){return(this[l]&E.ENC_SENDER)===E.ENC_SENDER}isEncryptionPassword(){return(this[l]&E.ENC_PASSWORD)===E.ENC_PASSWORD}isEncryptionPublic(){return(this[l]&E.ENC_PUBLIC)===E.ENC_PUBLIC}isNonDetermistic(){return(this[l]&E.NON_DETERMISTIC)===E.NON_DETERMISTIC}get password(){return this[A]}get payload(){return this[u]}get checksum(){return E.calculateChecksum(this.compile(!0))}set accountName(t){if(void 0!==this[h])throw new Error("Either set the account name or the account number. Both is not possible.");this[d]=new a(t),this[l]|=E.ADDRESSED_BY_NAME}set payload(t){if(this.hasFormat()||(this.format=E.FORMAT_ASCII),!(this.hasFormat()&&this.hasEncryption()||""===t.toString()))throw new Error("EPasa payloads can only be set when the encryption and format is defined.");return t instanceof i||(t=this.isFormatHex()?i.fromHex(t):i.fromString(t)),this.validatePayloadLength(t),this[u]=t,this}validatePayloadLength(t){let e="",r="ASCII";this.isFormatAscii()?e=t.toString():this.isFormatHex()?(e=t.toHex(),r="HEX"):this.isFormatBase58()&&(e=t.toString(),r="BASE58");let n="PUBLIC";if(this.isEncryptionReceiver()||this.isEncryptionSender()?n="ECIES":this.isEncryptionPassword()&&(n="AES"),e.length>E[`MAX_${n}_${r}`])throw new Error(`Invalid payload length ${e.length} for ${n}_${r}. \n        Max is ${E[`MAX_${n}_${r}`]}`);return!0}set password(t){this[A]=t}set encryption(t){if(t===E.ENC_PASSWORD&&void 0===this[A])throw new Error("Set password before setting the password encryption flag.");this[l]|=t}set format(t){this[l]|=t}compile(t=!1){let e={account:null,enc_marker_start:null,enc_marker_end:null,payload:""};if((this[l]&E.ADDRESSED_BY_NAME)===E.ADDRESSED_BY_NAME?e.account=this[d].toStringEscaped():e.account=this[h].toString(),void 0!==this[u]){if((this[l]&E.FORMAT_HEX)===E.FORMAT_HEX)e.payload=`0x${this[u].toHex().toLowerCase()}`;else if((this[l]&E.FORMAT_BASE58)===E.FORMAT_BASE58)e.payload=new s(this[u].toString()).toString();else if((this[l]&E.FORMAT_ASCII)===E.FORMAT_ASCII){let t=new c(this[u].toString()).toStringEscaped();t.length>0&&(e.payload=`"${t}"`)}if((this[l]&E.ENC_PUBLIC)===E.ENC_PUBLIC)e.enc_marker_start="[",e.enc_marker_end="]";else if((this[l]&E.ENC_RECEIVER)===E.ENC_RECEIVER)e.enc_marker_start="(",e.enc_marker_end=")";else if((this[l]&E.ENC_SENDER)===E.ENC_SENDER)e.enc_marker_start="<",e.enc_marker_end=">";else if((this[l]&E.ENC_PASSWORD)===E.ENC_PASSWORD){e.enc_marker_start="{",e.enc_marker_end="}";let t=new c(this[A]);e.payload+=`:${t.toStringEscaped()}`}}else e.payload="",e.enc_marker_start="",e.enc_marker_end="";let r=`${e.account}${e.enc_marker_start}${e.payload}${e.enc_marker_end}`;return t?r:`${r}:${E.calculateChecksum(r)}`}static calculateChecksum(t){return i.fromInt(o.x86.hash32(t)%65536).switchEndian().toHex(!0)}}t.exports=E},function(t,e){const r=Symbol("value"),n="123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ".split("");class a{constructor(t){this[r]=t instanceof a?t.toString():a.validate(t)}static validate(t){if(0===t.length)return t;for(let e=0;e<t.length;e++)if(-1===n.indexOf(t[e]))throw new Error(`Invalid base58 - character ${t[e]} not allowed at position ${e}`);return t}toString(){return this[r]}}t.exports=a},function(t,e,r){t.exports=r(5)},function(t,e,r){t.exports={Parser:r(6),EPasa:r(2),Types:{Ascii:r(1),Base58:r(3)}}},function(t,e,r){const n=r(2),a=r(1),o=r(0).BC,c=r(0).Types.AccountName;t.exports=class{static parse(t){let e={inAccount:!0,inPayload:!1,inPassword:!1,inChecksum:!1,checksumIdentFound:!1,account:"",payload:"",format:null,encryption:null,checksum:"",password:"",asciiOpen:!1,asciiClosed:!1,encOpen:!1,encClosed:!1},r=0;const s=function(e,n){if(r>t.length-1)return!1;let o=!1;return e?o=c.isEscape(t[r],t[r+1]):n&&(o=a.isEscape(t[r],t[r+1])),r++,o&&r++,{escaped:o,char:t[r-1],next:t[r]}};let i;for(;!1!==(i=s(e.inAccount,e.inPayload));)if(e.inAccount&&!1===i.escaped&&["[","(","{","<"].indexOf(i.char)>-1&&(e.inAccount=!1,e.inPayload=!0),null===e.encryption&&!1===i.escaped&&e.inPayload&&["[","(","{","<"].indexOf(i.char)>-1)"["===i.char?e.encryption=n.ENC_PUBLIC:"("===i.char?e.encryption=n.ENC_RECEIVER:"<"===i.char?e.encryption=n.ENC_SENDER:"{"===i.char&&(e.encryption=n.ENC_PASSWORD),e.encOpen=i.char;else if(!1!==i.escaped||!e.inPayload&&!e.inAccount||":"!==i.char)if(!1===i.escaped&&'"'===i.char&&e.inPayload&&null===e.format)e.format=n.FORMAT_ASCII,e.asciiOpen=!0;else{if(!1===i.escaped&&"0"===i.char&&"x"===i.next&&e.inPayload&&null===e.format)e.format=n.FORMAT_HEX;else if(!1===i.escaped&&e.inPayload&&null===e.format)e.format=n.FORMAT_BASE58;else if(!1===i.escaped&&'"'===i.char&&e.inPayload&&e.format===n.FORMAT_ASCII){e.asciiClosed=!0;continue}!1===i.escaped&&e.inPayload&&["]",")","}",">"].indexOf(i.char)>-1?(e.inPayload=!1,e.inChecksum=!0,e.encClosed=i.char):e.inAccount?e.account+=i.char:(e.inPayload&&!e.inPassword&&(e.payload+=i.char),e.inPayload&&e.inPassword&&(e.password+=i.char),e.inChecksum&&":"!==i.char&&(e.checksum+=i.char))}else e.encryption===n.ENC_PASSWORD?e.inPassword=!0:(e.inPassword=!1,e.inChecksum=!0,e.inAccount=!1,e.checksumIdentFound=!0);if(e.asciiOpen&&!e.asciiClosed)throw new Error("Invalid EPasa - missing closing ascii");if(!1!==e.encOpen&&!1===e.encClosed)throw new Error("Invalid EPasa - missing closing encryption identifier");if("["===e.encOpen&&"]"!==e.encClosed||"("===e.encOpen&&")"!==e.encClosed||"<"===e.encOpen&&">"!==e.encClosed||"{"===e.encOpen&&"}"!==e.encClosed)throw new Error("Invalid EPasa - wrong closing encryption identifier");if(e.inChecksum&&e.checksum.length<4&&e.checksumIdentFound)throw new Error("Invalid EPasa - missing or too short checksum");if(e.inChecksum&&e.checksum.length>4&&e.checksumIdentFound)throw new Error("Invalid EPasa - missing or too long checksum");if(e.format===n.FORMAT_HEX&&e.payload.substr(2).length>0&&!1===/^[0-9a-f]+$/.test(e.payload.substr(2)))throw new Error("Invalid EPasa - only lowercase hex allowed.");let h=new n;try{h.accountNumber=e.account}catch(t){try{h.accountName=e.account}catch(e){throw new Error(`Bad account for epasa: ${t.message} - ${e.message}`)}}if(e.encryption===n.ENC_PASSWORD&&(h.password=e.password),e.format===n.FORMAT_BASE58&&""!==e.payload&&(h.format=e.format),h.encryption=e.encryption,e.format===n.FORMAT_HEX?h.payload=o.fromHex(e.payload.substr(2)):null!==e.format&&(h.payload=o.fromString(e.payload)),""!==e.checksum&&n.calculateChecksum(h.compile(!0))!==e.checksum)throw new Error("Invalid checksum provided");return h}}},function(t,e,r){"use strict";(function(t){t.exports={v3:r(9)},r.c[r.s]===t&&console.log(t.exports.v3)}).call(this,r(8)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,r){"use strict";t.exports=r(10)},function(t,e,r){!function(r,n){"use strict";var a={version:"2.1.2",x86:{},x64:{}};function o(t,e){return(65535&t)*e+(((t>>>16)*e&65535)<<16)}function c(t,e){return t<<e|t>>>32-e}function s(t){return t=o(t^=t>>>16,2246822507),t=o(t^=t>>>13,3266489909),t^=t>>>16}function i(t,e){t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]],e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]];var r=[0,0,0,0];return r[3]+=t[3]+e[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=t[2]+e[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=t[1]+e[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=t[0]+e[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function h(t,e){t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]],e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]];var r=[0,0,0,0];return r[3]+=t[3]*e[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=t[2]*e[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=t[3]*e[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=t[1]*e[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=t[2]*e[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=t[3]*e[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=t[0]*e[3]+t[1]*e[2]+t[2]*e[1]+t[3]*e[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function d(t,e){return 32===(e%=64)?[t[1],t[0]]:e<32?[t[0]<<e|t[1]>>>32-e,t[1]<<e|t[0]>>>32-e]:(e-=32,[t[1]<<e|t[0]>>>32-e,t[0]<<e|t[1]>>>32-e])}function u(t,e){return 0===(e%=64)?t:e<32?[t[0]<<e|t[1]>>>32-e,t[1]<<e]:[t[1]<<e-32,0]}function l(t,e){return[t[0]^e[0],t[1]^e[1]]}function A(t){return t=l(t,[0,t[0]>>>1]),t=l(t=h(t,[4283543511,3981806797]),[0,t[0]>>>1]),t=l(t=h(t,[3301882366,444984403]),[0,t[0]>>>1])}a.x86.hash32=function(t,e){e=e||0;for(var r=(t=t||"").length%4,n=t.length-r,a=e,i=0,h=3432918353,d=461845907,u=0;u<n;u+=4)i=o(i=255&t.charCodeAt(u)|(255&t.charCodeAt(u+1))<<8|(255&t.charCodeAt(u+2))<<16|(255&t.charCodeAt(u+3))<<24,h),i=o(i=c(i,15),d),a=o(a=c(a^=i,13),5)+3864292196;switch(i=0,r){case 3:i^=(255&t.charCodeAt(u+2))<<16;case 2:i^=(255&t.charCodeAt(u+1))<<8;case 1:i=o(i^=255&t.charCodeAt(u),h),a^=i=o(i=c(i,15),d)}return(a=s(a^=t.length))>>>0},a.x86.hash128=function(t,e){e=e||0;for(var r=(t=t||"").length%16,n=t.length-r,a=e,i=e,h=e,d=e,u=0,l=0,A=0,E=0,C=597399067,p=2869860233,f=951274213,m=2716044179,_=0;_<n;_+=16)u=255&t.charCodeAt(_)|(255&t.charCodeAt(_+1))<<8|(255&t.charCodeAt(_+2))<<16|(255&t.charCodeAt(_+3))<<24,l=255&t.charCodeAt(_+4)|(255&t.charCodeAt(_+5))<<8|(255&t.charCodeAt(_+6))<<16|(255&t.charCodeAt(_+7))<<24,A=255&t.charCodeAt(_+8)|(255&t.charCodeAt(_+9))<<8|(255&t.charCodeAt(_+10))<<16|(255&t.charCodeAt(_+11))<<24,E=255&t.charCodeAt(_+12)|(255&t.charCodeAt(_+13))<<8|(255&t.charCodeAt(_+14))<<16|(255&t.charCodeAt(_+15))<<24,u=c(u=o(u,C),15),a=c(a^=u=o(u,p),19),a=o(a+=i,5)+1444728091,l=c(l=o(l,p),16),i=c(i^=l=o(l,f),17),i=o(i+=h,5)+197830471,A=c(A=o(A,f),17),h=c(h^=A=o(A,m),15),h=o(h+=d,5)+2530024501,E=c(E=o(E,m),18),d=c(d^=E=o(E,C),13),d=o(d+=a,5)+850148119;switch(u=0,l=0,A=0,E=0,r){case 15:E^=t.charCodeAt(_+14)<<16;case 14:E^=t.charCodeAt(_+13)<<8;case 13:E=o(E^=t.charCodeAt(_+12),m),d^=E=o(E=c(E,18),C);case 12:A^=t.charCodeAt(_+11)<<24;case 11:A^=t.charCodeAt(_+10)<<16;case 10:A^=t.charCodeAt(_+9)<<8;case 9:A=o(A^=t.charCodeAt(_+8),f),h^=A=o(A=c(A,17),m);case 8:l^=t.charCodeAt(_+7)<<24;case 7:l^=t.charCodeAt(_+6)<<16;case 6:l^=t.charCodeAt(_+5)<<8;case 5:l=o(l^=t.charCodeAt(_+4),p),i^=l=o(l=c(l,16),f);case 4:u^=t.charCodeAt(_+3)<<24;case 3:u^=t.charCodeAt(_+2)<<16;case 2:u^=t.charCodeAt(_+1)<<8;case 1:u=o(u^=t.charCodeAt(_),C),a^=u=o(u=c(u,15),p)}return a^=t.length,a+=i^=t.length,a+=h^=t.length,i+=a+=d^=t.length,h+=a,d+=a,a=s(a),a+=i=s(i),a+=h=s(h),i+=a+=d=s(d),h+=a,d+=a,("00000000"+(a>>>0).toString(16)).slice(-8)+("00000000"+(i>>>0).toString(16)).slice(-8)+("00000000"+(h>>>0).toString(16)).slice(-8)+("00000000"+(d>>>0).toString(16)).slice(-8)},a.x64.hash128=function(t,e){e=e||0;for(var r=(t=t||"").length%16,n=t.length-r,a=[0,e],o=[0,e],c=[0,0],s=[0,0],E=[2277735313,289559509],C=[1291169091,658871167],p=0;p<n;p+=16)c=[255&t.charCodeAt(p+4)|(255&t.charCodeAt(p+5))<<8|(255&t.charCodeAt(p+6))<<16|(255&t.charCodeAt(p+7))<<24,255&t.charCodeAt(p)|(255&t.charCodeAt(p+1))<<8|(255&t.charCodeAt(p+2))<<16|(255&t.charCodeAt(p+3))<<24],s=[255&t.charCodeAt(p+12)|(255&t.charCodeAt(p+13))<<8|(255&t.charCodeAt(p+14))<<16|(255&t.charCodeAt(p+15))<<24,255&t.charCodeAt(p+8)|(255&t.charCodeAt(p+9))<<8|(255&t.charCodeAt(p+10))<<16|(255&t.charCodeAt(p+11))<<24],c=d(c=h(c,E),31),a=i(a=d(a=l(a,c=h(c,C)),27),o),a=i(h(a,[0,5]),[0,1390208809]),s=d(s=h(s,C),33),o=i(o=d(o=l(o,s=h(s,E)),31),a),o=i(h(o,[0,5]),[0,944331445]);switch(c=[0,0],s=[0,0],r){case 15:s=l(s,u([0,t.charCodeAt(p+14)],48));case 14:s=l(s,u([0,t.charCodeAt(p+13)],40));case 13:s=l(s,u([0,t.charCodeAt(p+12)],32));case 12:s=l(s,u([0,t.charCodeAt(p+11)],24));case 11:s=l(s,u([0,t.charCodeAt(p+10)],16));case 10:s=l(s,u([0,t.charCodeAt(p+9)],8));case 9:s=h(s=l(s,[0,t.charCodeAt(p+8)]),C),o=l(o,s=h(s=d(s,33),E));case 8:c=l(c,u([0,t.charCodeAt(p+7)],56));case 7:c=l(c,u([0,t.charCodeAt(p+6)],48));case 6:c=l(c,u([0,t.charCodeAt(p+5)],40));case 5:c=l(c,u([0,t.charCodeAt(p+4)],32));case 4:c=l(c,u([0,t.charCodeAt(p+3)],24));case 3:c=l(c,u([0,t.charCodeAt(p+2)],16));case 2:c=l(c,u([0,t.charCodeAt(p+1)],8));case 1:c=h(c=l(c,[0,t.charCodeAt(p)]),E),a=l(a,c=h(c=d(c,31),C))}return a=i(a=l(a,[0,t.length]),o=l(o,[0,t.length])),o=i(o,a),a=i(a=A(a),o=A(o)),o=i(o,a),("00000000"+(a[0]>>>0).toString(16)).slice(-8)+("00000000"+(a[1]>>>0).toString(16)).slice(-8)+("00000000"+(o[0]>>>0).toString(16)).slice(-8)+("00000000"+(o[1]>>>0).toString(16)).slice(-8)},t.exports&&(e=t.exports=a),e.murmurHash3=a}()}])});
//# sourceMappingURL=epasa.light.min.js.map